<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Mathematics is the language with which God wrote the Universe."><title>Mobile上飞起的神经网络-TensorFlow篇 | Tsui's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Mobile上飞起的神经网络-TensorFlow篇</h1><a id="logo" href="/.">Tsui's Blog</a><p class="description">种一棵树最好的时间是十年前，其次是现在</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Mobile上飞起的神经网络-TensorFlow篇</h1><div class="post-meta">Nov 14, 2017</div><div class="post-content"><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>本篇只是简单的记录了一下将TensorFlow公开出来的Android Camera Demo运行起来的一个过程。<br>关于TensorFlow的source的解读，争取今年内能起个头吧～～<br>本篇大致按照以下章节来介绍一哈子  </p>
<ul>
<li>我的编译环境  </li>
<li>TensorFlow的源码在哪里  </li>
<li>构建工具-bazel  </li>
<li>编译Android Camera Demo还需要哪些配置  </li>
<li>Android Camera Demo用到的的四个模型  </li>
<li>Android Camera Demo的编译和产物</li>
<li>参考资料</li>
</ul>
<h1 id="言归正传"><a href="#言归正传" class="headerlink" title="言归正传"></a>言归正传</h1><h2 id="I-我的编译环境"><a href="#I-我的编译环境" class="headerlink" title="I. 我的编译环境"></a>I. 我的编译环境</h2><p>我其实不爱吃苹果，也不爱吃米～～  </p>
<hr>
<p>MacBook Pro<br>Processor 2.4 GHz Intel Core i5<br>Memory 8GN 1600 MHz DDR3<br>macOS High Sierra (Version 10.13.2 Beta)</p>
<hr>
<h2 id="II-TensorFlow的源码"><a href="#II-TensorFlow的源码" class="headerlink" title="II. TensorFlow的源码"></a>II. TensorFlow的源码</h2><p>TensorFlow的源码托管在Github上面，源码地址如下：<br><a href="https://github.com/tensorflow/tensorflow" target="_blank" rel="noopener">https://github.com/tensorflow/tensorflow</a></p>
<p>其中Android Camera Demo地址如下：<br><a href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android" target="_blank" rel="noopener">https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android</a></p>
<p>这里问题来了，我们只想编译安卓版的apk，是不是只要把android的部分的source搞下来就可以了呢。<br>但是，貌似是不行的。<br>TensorFlow的编译都是使用Bazel来进行的，而编译时android版的编译需要使用到的SDK和NDK的路径的配置都是在<br>tensorFlow整个工程的WORKSPACE文件中指定的。<br>而且，从git上面clone代码的时候，似乎也只能git整个tensorflow的工程下来。  </p>
<p>所以这里，我们来敲一把下面的命令将TensorFlow的source给clone下来先～<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:tensorflow/tensorflow.git</span><br></pre></td></tr></table></figure></p>
<h2 id="III-构建工具-bazel"><a href="#III-构建工具-bazel" class="headerlink" title="III. 构建工具-bazel"></a>III. 构建工具-bazel</h2><p><strong>问1:构建工具是神马?</strong><br><strong>回答：</strong><br>构建工具是一个将源代码生成可执行应用程序的过程自动化的程序。<br>一般构建工具的套路就是创建一票的task，每个task会负责完成一个任务，例如：下载依赖、编译、打包、部署等等。<br>构建工具的使命就是将俺们从枯燥重复的无脑工作中解放出来，讲真，只要你task设计的好，流程设计的好，使用构建工具其实可以避开一些低级的错误。<br>常见的构建工具比如：Gradle、Maven、Ant、Grunt、Gulf等等<br><a href="https://en.wikipedia.org/wiki/List_of_build_automation_software" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/List_of_build_automation_software</a></p>
<p><strong><em>Bazel</em></strong>也是构建工具大军中的一枚小将～</p>
<p><strong>问2：为啥TensorFlow偏偏选中了Bazel呢？</strong><br><strong>回答：</strong><br>你猜猜TensorFlow姓啥？Bazel又姓啥？<br>其实谷家的Bazel貌似还是挺好用的，支持多平台，上到服务器应用下到移动端应用。<br>infoq上面有一篇15年的短文，简要的介绍了下谷家的Bazel。有兴趣的同学可以去看一看。<br><a href="http://www.infoq.com/cn/news/2015/03/google-open-source-bazel" target="_blank" rel="noopener">http://www.infoq.com/cn/news/2015/03/google-open-source-bazel</a></p>
<p><strong>问3: Bazel怎么安装?</strong><br><strong>回答：</strong>  </p>
<ol>
<li>找到Bazel的安装脚本<br>Bazel也是托管在GitHub上面的<br><a href="https://github.com/bazelbuild/bazel" target="_blank" rel="noopener">https://github.com/bazelbuild/bazel</a><br>对应的releases页面<br><a href="https://github.com/bazelbuild/bazel/releases" target="_blank" rel="noopener">https://github.com/bazelbuild/bazel/releases</a><br>从↑的页面上找到你编译机器配置对应的Bazel安装脚本，搞下来<br>比如我的Mac对应的版本是：bazel-0.7.0-installer-darwin-x86_64.sh</li>
<li><p>给Bazel的安装脚本追加权限</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chomd +x bazel-0.7.0-installer-darwin-x86_64.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行脚本，完成Bazel的安装</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bazel-0.7.0-installer-darwin-x86_64.sh --user</span><br></pre></td></tr></table></figure>
</li>
<li><p>确认安装结果<br>此时此刻，你执行一下</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bazel version</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>得到以下输出的话，就说明你的安装妥妥的了<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Build label: 0.7.0</span><br><span class="line">Build target: bazel-out/darwin_x86_64-opt/bin/src/main/java/com/google/devtools/build/lib/bazel/BazelServer_deploy.jar</span><br><span class="line">Build time: Wed Oct 18 14:25:46 2017 (1508336746)</span><br><span class="line">Build timestamp: 1508336746</span><br><span class="line">Build timestamp as int: 1508336746</span><br></pre></td></tr></table></figure></p>
<h2 id="IV-编译Android-Camera-Demo还需要哪些配置"><a href="#IV-编译Android-Camera-Demo还需要哪些配置" class="headerlink" title="IV. 编译Android Camera Demo还需要哪些配置"></a>IV. 编译Android Camera Demo还需要哪些配置</h2><h2 id="1-Android-SDK"><a href="#1-Android-SDK" class="headerlink" title="1. Android SDK  "></a>1. Android SDK  </h2><p>我这边使用的SDK和对应的版本如下：  </p>
<pre><code>- SDK Tools           26.1.1
- SDK Build-Tools     26.0.2
- SDK Platform-Tools  26.0.2  
</code></pre><p>  我都是直接通过AndroidStudio3预览版的SDKmanager来下的<br>  AndroidStudio的SDKmanager会将这些东西下到你在AndrooidStudio里面指定的SDK的路径保存好</p>
<h2 id="2-Android-NDK"><a href="#2-Android-NDK" class="headerlink" title="2. Android NDK  "></a>2. Android NDK  </h2><p>NDK我用的r14b<br><a href="https://dl.google.com/android/repository/android-ndk-r14b-darwin-x86_64.zip" target="_blank" rel="noopener">https://dl.google.com/android/repository/android-ndk-r14b-darwin-x86_64.zip</a><br>这边下好的NDK解压后，记录下存放路径<br>注）<br>一开始我用最新版的NDK来编译，死活编译不过去。各种头文件找不到的错误。<br>stackoverflow上面搜了一把，大都问题跑出来，却木有答案。<br>最后一个版本一个版本的将NDK降级，到了r14b这儿终于编过去了。编得我满脸老泪。。。  </p>
<h2 id="3-将SDK和NDK的path反应到项目中"><a href="#3-将SDK和NDK的path反应到项目中" class="headerlink" title="3. 将SDK和NDK的path反应到项目中"></a>3. 将SDK和NDK的path反应到项目中</h2><h3 id="方式1-WORKSPACE文件的修改"><a href="#方式1-WORKSPACE文件的修改" class="headerlink" title="方式1 : WORKSPACE文件的修改"></a>方式1 : WORKSPACE文件的修改</h3><p>TensorFlow的最上层有一个WORKSPACE文件。<br>因为所有的Bazel的构建都是基于一个workspace的，这个workspace里面包含了所有的源码目录、构建后的输出目录的符号链接。<br>workspace的根目录下需要存在一个workspace的配置文件，文件名：WORKSPACE。<br>WORKSPACE文件里面可以指定一些外部构建输出需要的依赖关系、但这些内容不是必须的，即便是空文件也是可以的。  </p>
<p>   TensorFlow这边的WORKSPACE文件中将一些和Android Camera Demo相关的依赖信息加在了里面<br>   比如下面这一段，github上clone下来的源码，以下部分都是注释掉的，<br>   编译安卓版的话，需要大家将自己编译机上面配置的SDK和NDK的相关信息反应到WORKSPACE文件中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"># Uncomment and update the paths in these entries to build the Android demo.</span><br><span class="line">android_sdk_repository(</span><br><span class="line">    name = &quot;androidsdk&quot;,</span><br><span class="line">    api_level = 23,</span><br><span class="line">    # Ensure that you have the build_tools_version below installed in the</span><br><span class="line">    # SDK manager as it updates periodically.</span><br><span class="line">    build_tools_version = &quot;26.0.2&quot;,</span><br><span class="line">    # Replace with path to Android SDK on your system</span><br><span class="line">    path = &quot;/Users/cristinagreen/Library/Android/sdk&quot;,</span><br><span class="line">)</span><br><span class="line">#</span><br><span class="line">android_ndk_repository(</span><br><span class="line">    name=&quot;androidndk&quot;,</span><br><span class="line">    path=&quot;/Users/cristinagreen/Library/Android/ndk&quot;,</span><br><span class="line">#    # This needs to be 14 or higher to compile TensorFlow.</span><br><span class="line">#    # Please specify API level to &gt;= 21 to build for 64-bit</span><br><span class="line">#    # archtectures or the Android NDK will automatically select biggest</span><br><span class="line">#    # API level that it supports without notice.</span><br><span class="line">#    # Note that the NDK version is not the API level.</span><br><span class="line">    api_level=14)</span><br><span class="line">```  </span><br><span class="line">### 方式2 : 设置环境变量 ###   </span><br><span class="line">  如果WORKSPACE文件你什么都不改的话，会发生什么呢？    </span><br><span class="line">  /tensorflow/tensorflow/tools/ci_build/builds/builds_common.sh  </span><br><span class="line">  中有这么一段</span><br><span class="line"></span><br><span class="line"> ~~~~~~~</span><br><span class="line">configure_android_workspace() &#123;</span><br><span class="line">  # Modify the WORKSPACE file.</span><br><span class="line">  # Note: This is workaround. This should be done by bazel.</span><br><span class="line">  if grep -q &apos;^android_sdk_repository&apos; WORKSPACE &amp;&amp; grep -q &apos;^android_ndk_repository&apos; WORKSPACE; then</span><br><span class="line">    echo &quot;You probably have your WORKSPACE file setup for Android.&quot;</span><br><span class="line">  else</span><br><span class="line">    if [ -z &quot;$&#123;ANDROID_API_LEVEL&#125;&quot; -o -z &quot;$&#123;ANDROID_BUILD_TOOLS_VERSION&#125;&quot; ] || \</span><br><span class="line">        [ -z &quot;$&#123;ANDROID_SDK_HOME&#125;&quot; -o -z &quot;$&#123;ANDROID_NDK_HOME&#125;&quot; ]; then</span><br><span class="line">      echo &quot;ERROR: Your WORKSPACE file does not seems to have proper android&quot;</span><br><span class="line">      echo &quot;       configuration and not all the environment variables expected&quot;</span><br><span class="line">      echo &quot;       inside ci_build android docker container are set.&quot;</span><br><span class="line">      echo &quot;       Please configure it manually. See: https://github.com/tensorflow/tensorflow/tree/master/tensorflow/examples/android/README.md&quot;</span><br><span class="line">    else</span><br><span class="line">      cat &lt;&lt; EOF &gt;&gt; WORKSPACE</span><br><span class="line">android_sdk_repository(</span><br><span class="line">    name = &quot;androidsdk&quot;,</span><br><span class="line">    api_level = $&#123;ANDROID_API_LEVEL&#125;,</span><br><span class="line">    build_tools_version = &quot;$&#123;ANDROID_BUILD_TOOLS_VERSION&#125;&quot;,</span><br><span class="line">    path = &quot;$&#123;ANDROID_SDK_HOME&#125;&quot;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">android_ndk_repository(</span><br><span class="line">    name=&quot;androidndk&quot;,</span><br><span class="line">    path=&quot;$&#123;ANDROID_NDK_HOME&#125;&quot;,</span><br><span class="line">    api_level=14)</span><br><span class="line">EOF</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br><span class="line"> ~~~~~~~    </span><br><span class="line"></span><br><span class="line">很明显，这段脚本是在构建Android Camera Demo的workspace，主要就是为了确认和根据系统环境变量的信息修补WORKSPACE文件.  </span><br><span class="line">简单的说，</span><br></pre></td></tr></table></figure></p>
<p>if WORKSPACE文件中配置了SDK和NDK的信息 then 愉快的开始编译吧<br>if WORKSPACE文件中没有SDK和NDK then 我好心的帮你找一找是不是可以通过环境变量来找到信息并补充到WORKSPACE文件中呀<br>if WORKSPACE文件中没有配置 &amp; 你懒到环境变量也没有搞 then 还编个毛线 喝汤去<br>```</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>配置SDK和NDk，你需要  </p>
<ol>
<li>下好正确版本的SDK和NDK</li>
<li>将SDK和NDK的相关信息通过以下任一方式传送给项目<ul>
<li>WORKSPACE文件</li>
<li>配置全局环境变量<br>ANDROID_API_LEVEL、ANDROID_BUILD_TOOLS_VERSION、ANDROID_SDK_HOME、ANDROID_NDK_HOME</li>
</ul>
</li>
</ol>
<h2 id="V-Android-Camera-Demo用到的的四个模型"><a href="#V-Android-Camera-Demo用到的的四个模型" class="headerlink" title="V. Android Camera Demo用到的的四个模型"></a>V. Android Camera Demo用到的的四个模型</h2><p>Android Camera Demo提供了四个sample，各个sample其实是直接调用了PC端已经训练好的轻量级的model，这些个model的信息可以参照github上的说明。  </p>
<hr>
<p> TF Classify: Uses the Google Inception model to classify camera frames in real-time, displaying the top results in an overlay on the camera image.<br>TF Detect: Demonstrates an SSD-Mobilenet model trained using the Tensorflow Object Detection API introduced in Speed/accuracy trade-offs for modern convolutional object detectors to localize and track objects (from 80 categories) in the camera preview in real-time.<br>TF Stylize: Uses a model based on A Learned Representation For Artistic Style to restyle the camera preview image to that of a number of different artists.<br>TF Speech: Runs a simple speech recognition model built by the audio training tutorial. Listens for a small set of words, and highlights them in the UI when they are recognized.</p>
<hr>
<p>辣么，问题来了，Android Camera Demo依赖的四个model是怎么整进工程的呢？<br>看！我们的WORKSPACE文件这边还藏了这么一段～～<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"># Please add all new TensorFlow dependencies in workspace.bzl.</span><br><span class="line">tf_workspace()</span><br><span class="line"></span><br><span class="line">new_http_archive(</span><br><span class="line">    name = &quot;inception5h&quot;,</span><br><span class="line">    build_file = &quot;models.BUILD&quot;,</span><br><span class="line">    sha256 = &quot;d13569f6a98159de37e92e9c8ec4dae8f674fbf475f69fe6199b514f756d4364&quot;,</span><br><span class="line">    urls = [</span><br><span class="line">        &quot;http://storage.googleapis.com/download.tensorflow.org/models/inception5h.zip&quot;,</span><br><span class="line">        &quot;http://download.tensorflow.org/models/inception5h.zip&quot;,</span><br><span class="line">    ],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">new_http_archive(</span><br><span class="line">    name = &quot;mobile_ssd&quot;,</span><br><span class="line">    build_file = &quot;models.BUILD&quot;,</span><br><span class="line">    sha256 = &quot;bddd81ea5c80a97adfac1c9f770e6f55cbafd7cce4d3bbe15fbeb041e6b8f3e8&quot;,</span><br><span class="line">    urls = [</span><br><span class="line">        &quot;http://storage.googleapis.com/download.tensorflow.org/models/object_detection/ssd_mobilenet_v1_android_export.zip&quot;,</span><br><span class="line">        &quot;http://download.tensorflow.org/models/object_detection/ssd_mobilenet_v1_android_export.zip&quot;,</span><br><span class="line">    ],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">new_http_archive(</span><br><span class="line">    name = &quot;mobile_multibox&quot;,</span><br><span class="line">    build_file = &quot;models.BUILD&quot;,</span><br><span class="line">    sha256 = &quot;859edcddf84dddb974c36c36cfc1f74555148e9c9213dedacf1d6b613ad52b96&quot;,</span><br><span class="line">    urls = [</span><br><span class="line">        &quot;http://storage.googleapis.com/download.tensorflow.org/models/mobile_multibox_v1a.zip&quot;,</span><br><span class="line">        &quot;http://download.tensorflow.org/models/mobile_multibox_v1a.zip&quot;,</span><br><span class="line">    ],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">new_http_archive(</span><br><span class="line">    name = &quot;stylize&quot;,</span><br><span class="line">    build_file = &quot;models.BUILD&quot;,</span><br><span class="line">    sha256 = &quot;3d374a730aef330424a356a8d4f04d8a54277c425e274ecb7d9c83aa912c6bfa&quot;,</span><br><span class="line">    urls = [</span><br><span class="line">        &quot;http://storage.googleapis.com/download.tensorflow.org/models/stylize_v1.zip&quot;,</span><br><span class="line">        &quot;http://download.tensorflow.org/models/stylize_v1.zip&quot;,</span><br><span class="line">    ],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">new_http_archive(</span><br><span class="line">    name = &quot;speech_commands&quot;,</span><br><span class="line">    build_file = &quot;models.BUILD&quot;,</span><br><span class="line">    sha256 = &quot;c3ec4fea3158eb111f1d932336351edfe8bd515bb6e87aad4f25dbad0a600d0c&quot;,</span><br><span class="line">    urls = [</span><br><span class="line">        &quot;http://storage.googleapis.com/download.tensorflow.org/models/speech_commands_v0.01.zip&quot;,</span><br><span class="line">        &quot;http://download.tensorflow.org/models/speech_commands_v0.01.zip&quot;,</span><br><span class="line">    ],</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>也就是说，使用Bazel来编译apk的时候，bazel会自动去下载model。<br>如果你用AndroidStudio直接来编apk的话，是需要手动去下载这些model的，并且你需要在<br><strong>build.gradle</strong><br>文件中，将你的bazel的环境信息更新进去<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// If building with Bazel, this is the location of the bazel binary.</span><br><span class="line">// NOTE: Bazel does not yet support building for Android on Windows,</span><br><span class="line">// so in this case the Makefile build must be used as described above.</span><br><span class="line">def bazelLocation = &apos;/usr/local/bin/bazel&apos;</span><br></pre></td></tr></table></figure></p>
<h2 id="VI-Android-Camera-Demo的编译和产物"><a href="#VI-Android-Camera-Demo的编译和产物" class="headerlink" title="VI. Android Camera Demo的编译和产物"></a>VI. Android Camera Demo的编译和产物</h2><p> 前面几步的准备都做足的话，这边你只需要轻轻的敲下<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bazel build tensorflow/examples/android:tensorflow_demo --verbose_failures</span><br></pre></td></tr></table></figure></p>
<p> 然后去打两把皇室，再回来看结果就可以了</p>
<p> 编译结束后，APK的输出位置如下  </p>
<p> bazel-bin/tensorflow/examples/android/<br> tensorflow_demo.apk</p>
<p> 将这个apk装到你的安卓设备上即可。</p>
<p>装完后，你会发现，你的launcher上面出现了四个app，分别对应的Android Camera Demo的四个sample  ～</p>
<ul>
<li>TF Classify</li>
<li>TF Detect</li>
<li>TF Stylize</li>
<li>TF Speech</li>
</ul>
<p>编出来的apk，我放的网盘上，需要的同学自己去取～  </p>
<hr>
<p>链接: <a href="https://pan.baidu.com/s/1i47cTtr" target="_blank" rel="noopener">https://pan.baidu.com/s/1i47cTtr</a><br>密码: 7an5</p>
<hr>
<h2 id="VII-参考资料"><a href="#VII-参考资料" class="headerlink" title="VII. 参考资料 "></a>VII. 参考资料 </h2><p> [1] <a href="http://blog.csdn.net/masa_fish/article/details/54097796" target="_blank" rel="noopener">http://blog.csdn.net/masa_fish/article/details/54097796</a><br> [2] <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/README.md" target="_blank" rel="noopener">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/android/README.md</a></p>
</div><div class="tags"></div><div class="post-nav"><a class="next" href="/2017/08/09/2017-08-09-Movies-post/">すーちゃん まいちゃん さわ子さん (2013)</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/11/14/2017-11-14-TensorflowLiteForAndroid-post/">Mobile上飞起的神经网络-TensorFlow篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/09/2017-08-09-Movies-post/">すーちゃん まいちゃん さわ子さん (2013)</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/07/11/2013-08-17-test-post/">Pre Post</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/06/01/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Tsui's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>